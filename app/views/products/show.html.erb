<div class="container product-show-page">
  <div class="row">
    <div class="show-option">
      <%= link_to("All Products", products_path) %>  >   <%= link_to(@product.category.name, products_path(category: @product.category.name)) %>
      <span class="pull-right"><%= link_to("Back", url_for(:back)) %></span>
    </div>

    <div class="product-show-box">
      <!-- product picture -->
      <div class="col-md-5">
        <% if @product.image.present? %>
          <%= image_tag(@product.image.medium.url, class: "thumbnail") %>
        <% else %>
          <%= image_tag("http://placehold.it/400x400&text=No Pic", class: "thumbnail") %>
        <% end %>
      </div>

      <div class="col-md-7">
        <!-- product title  -->
        <h2 class="product-title"><%= @product.title%></h2>

        <!-- product description  -->
        <div class="product-description">
          <span>
            <%= @product.description %>
          </span>
        </div>

        <!-- product price -->
        <div class="product-price">
          $ <%= @product.price %>
        </div>

        <div class="row">
          <div class="col-sm-6">

            <div class="product-detail">
              <span>
                Category: <%= link_to(@product.category.name, products_path(category: @product.category.name)) %>
              </span>
            </div>
            <!-- product quantity -->
            <div class="product-detail">
              <span>
                Quantity: <%= link_to("-", "", id: "quantity-minus", class: "quantity-minus btn btn-default disabled") %>
                        <input type="text" name="quantity" value="1" id="quantity-input" class="quantity-input">
                        <%= link_to("+", "", id: "quantity-plus", class: "quantity-plus btn btn-default #{@product.quantity <= 1 ? 'disabled' : ''}") %>
              </span>
            </div>
          </div>
        </div>


        <!-- Start button -->
        <div class="add-to-cart-buttom row">
            <!-- add product to cart -->
          <div class="col-sm-6">
            <% if @product.quantity.present? && @product.quantity > 0 %>
              <%= link_to("Add to Cart", add_to_cart_product_path(@product), method: :post, class: "btn btn-primary") %>
            <% else %>
              <a href="#" class="btn btn-danger active" role="button" disabled="disabled">Current not available</a>
            <% end %>
            <% if current_user && current_user.is_member_of?(@product) %>
              <%= link_to("Already in wishlist", quit_product_path(@product), method: :post, class: "btn btn-success") %>
            <% else %>
              <%= link_to("Add to wishlist", join_product_path(@product), method: :post, class: "btn btn-danger") %>
            <% end %>
          </div>
        </div>
        <!-- End button -->
      </div>
    </div>

    <div class="product-details">
      <div class="col-md-8  product-particulars">
        <div class="row">
          <ul class="nav nav-tabs nav-justified">
            <li class="active">
              <a href="#tab_default_1" data-toggle="tab">Product Details</a>
            </li>
            <li>
              <a href="#tab_default_2" data-toggle="tab">Comments (<%= @product.comments.count %>) </a>
            </li>
          </ul>
        </div>
        <div class="tab-content">
          <div class="product-particulars-box row tab-pane active" id="tab_default_1">
            <%= image_tag(@product.image.medium.url, class: "thumbnail") %>
          </div>
          <div class="product-particulars-box row tab-pane" id="tab_default_2">
            <div class="text-center">
              <h3>Evaluation</h3>
              Play Experience: <div class="star-play" data-score= <%= @avg_comment %> ></div>
              Price: <div class="star-price" data-score= <%= @avg_price %> ></div>
              Difficulty: <div class="star-difficulty" data-score= <%= @avg_difficulty %> ></div>
            </div>
            <%= link_to("Comment", new_product_comment_path(@product), :class => "btn btn-lg btn-info") %>
            <hr>
            <% @comments.each do |comment| %>
             <div class="comment"> 
                <ul>
                  <li>
                    <div class="row">
                      <div class="col-xs-7 comment-user-email"><%= comment.user.email %></div>
                      <div class="col-xs-4"><%= comment.created_at.strftime("%Y-%m-%d %H-%M-%S") %></div>
                      <div class="col-xs-1">
                        <% if comment.user == current_user %>
                          <%= link_to product_comment_path(@product, comment), :method => :delete, :class => "btn btn-xs btn-danger", :data => { :confirm => "Are you sure?" } do %><i class="fa fa-trash"></i><% end %>
                        <% end %>
                      </div>
                    </div>
                    <div class="comment">
                      Play Experience: <div class="star-play" data-score= <%= @avg_comment %> ></div>
                      Price: <div class="star-price" data-score= <%= @avg_price %> ></div>
                      Difficulty: <div class="star-difficulty" data-score= <%= @avg_difficulty %> ></div>
                      <%= comment.content %>
                    </div>
                  </li>
                </ul>
                <div class="comment-hr">
                  <hr>
                </div>
              </div>
            <% end %>
        </div>
      </div>
    </div>

  </div>
</div>


<script>
  $('.star-play').raty({
        path: '/assets/',
            readOnly: true,
            score: function() {
          return $(this).attr('data-score');
        }
  });
  $('.star-price').raty({
        path: '/assets/',
            readOnly: true,
            score: function() {
          return $(this).attr('data-score');
        }
  });
  $('.star-difficulty').raty({
        path: '/assets/',
            readOnly: true,
            score: function() {
          return $(this).attr('data-score');
        }
  });

  $('#star-play').raty({
  path: '/assets/',
  scoreName: 'comment[play]'
  });

  $('#star-price').raty({
  path: '/assets/',
  scoreName: 'comment[price]'
  });

  $('#star-difficulty').raty({
      path: '/assets/',
      scoreName: 'comment[difficulty]'
  });


// <!-- 必须要选一颗星 -->
//   $('#star-play img').eq(0).trigger('click')
//   $('#star-price img').eq(0).trigger('click')
//   $('#star-difficulty img').eq(0).trigger('click')

</script>
